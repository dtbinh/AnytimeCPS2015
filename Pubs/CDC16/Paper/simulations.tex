\section{Simulations}
\label{sec:simulations}

In order to evaluate our approach, we implemented our algorithm in MATLAB and simulated it with two plant models, including the example of Section ??. The set computations were done using the MPT Toolbox ??, and the invariant set computations using the Matlab Invariant Set Toolbox ??. For the reachability computations of Section ??, we perform reachability on the feedback linearized system with MPT using the steps outlined in Section ??, but with $E$ replaced by $\tilde{E}_{max}$ and the control set $U$ replaced by $\oa{V}_{k+j|k}$. The set $\oaXset{k+j}{k}$ is then obtained by applying the diffeomorphism to the set $\oa{Z}_{k+j|k}$, and the properties of Lemma ?? still hold. The RMPC algorithm was implemented in CVX [??] and Gurobi [??] was used as the solver.

\subsection{Toy example}

For the running example of Eq. ??, we show the state trajectories for the feedback linearized system in Fig. ?? and for the non-linear system in Fig ??. The input for the feedback linearized system is shown in Fig. along with its upper and lower rectangular bounds computed online, denoted as $ V^{max}_{k|k}$ and $ V^{min}_{k|k}$ respectively, which make up the input constraint set at time $k$, $V_{k|k}$. Also shown is the global inner approximation for the input $v$. It is worth noting that the bounds computed online allow for much more control action than the conservative $V_{inner-global}$. Fig. ?? shows the input to the actual system, $u$. Note, that $u_k \in U \forall k$, as the defintion for $V_{k|k}$ implies. These figures show that, as formulated, the algorithm stabilizes the system while robustly satisfying the state and input constraints.

\subsection{Single link flexible joint manipulator}

As a more complex example, we consider the single link flexible manipulator dynamics, which have also been covered in ??,??,??. The non-linear plant dynamics are given as:

\begin{equation}
\begin{bmatrix} \dot{x}_1 \\ \dot{x}_2 \\ \dot{x}_3 \\ \dot{x}_4    \end{bmatrix} = \begin{bmatrix} x_2 \\ -\frac{mgl}{I}sin(x_1) - \frac{k}{I}(x_1-x_3)  \\ x_4 \\ \frac{k}{J}(x_1-x_3)  \end{bmatrix} + \begin{bmatrix} 0 \\ 0 \\ 0 \\ \frac{1}{J} \end{bmatrix}u
\end{equation}

This models a system where a motor, with an angular moment of inertia $J$,  is coupled to a uniform thin bar of of mass $m$, length $l$ and moment of inertia $I$, through a flexible link, where the flexibility is modeled by a torsional string with stiffness $k$. Here, $x_2$ is the angle of the motor shaft and $x_4$ the rate. The angle of the bar at the end of the flexible link is $x_1$ and its rate  is $x_3$. The input to the system is the motor torque, given by $u$. 

Without getting into the details of the feedback linearization, the diffeomorphism mapping the states of the non-linear system to the feedback linearized system, which is valid in the domain $x \in \mathbb{R}^4$ is given by:

\begin{equation}
z = T(x) = \begin{bmatrix} x_1 \\ x_2 \\ -\frac{mgl}{I}sin(x_1) -\frac{k}{I}(x_1-x_3) \\ \frac{mgl}{I}x_2cos(x_1) - \frac{k}{I}(x_2-x_4)   \end{bmatrix}
\end{equation}

For the linearization of Eq. ??, where $\hat{z}_k = z_k + M(x_k)e_k$, the matrix $M(x_k)$ is given by:
\begin{equation}
M(x_k) = \begin{bmatrix} 1&0&0&0 \\ 0&1&0&0 \\ -\frac{mgl}{I} cos(x_{1k}) -\frac{k}{I} &0 &\frac{k}{I} &0 \\ \frac{mgl}{I}x_{2k}sin(x_{1k}) & -\frac{mgl}{I} cos(x_{1k}) - \frac{k}{I} & 0 & \frac{k}{I}     \end{bmatrix}
\end{equation}

Also, the input to the feedback linearized system is given by:

\begin{subequations}
\label{eq:fblin_inp}
\begin{align}
v&=\beta u+ \alpha(x) \\
&\text{Where,} \nonumber \\
\beta&=\frac{k}{IJ} \\
\alpha(x)&=\frac{mgl}{I}x_2^2sin(x_1) + \frac{k^2}{IJ}(x_1-x_3) \nonumber \\
&- (\frac{mgl}{I}cos(x_1)-\frac{k}{I})(\frac{mgl}{I}sin(x_1)+\frac{k}{I}(x_1-x_3))
\end{align}
\end{subequations}

The safe set for the states is defined as follows, 
\begin{equation}
 -\begin{bmatrix} \pi/4  \\ \pi/4  \\ \pi \\ \pi \end{bmatrix} \leq x \leq \begin{bmatrix} \pi/4  \\ \pi/4  \\ \pi \\ \pi \end{bmatrix}
\end{equation}

Where the angles and their derivatives are in radians and radians per second respectively. Note, the safe set places a smaller degree of freedom on the range and angular velocities of the rod compared to the motor shaft.
The limits on the input torque, in $Nm$, $u$, are given by the set $U = u :-10 \leq u \leq 10$. The estimation for the state estimation, where $\hat{x} = x + e$ are given by $E = e:-\pi /180 \leq e \leq \pi /180 $, where the units are radians and radians per second accordingly. 

From Eq. \ref{eq:fblin_inp}, we can compute $V_{inner-global} =v: max_{x\in X}\alpha(x) + (k/IJ)\underline{u} \leq v \leq min_{x\in X}\alpha(x) + (k/IJ)\overline{u}$. Since $X$ is a hyper rectangle, we can compute $\overline{\alpha}(x)_{X} \geq  max_{x\in X}\alpha(x)$ using interval arithmetic, and similarly $\underline{\alpha}(x)_{X} \leq  min_{x\in X}\alpha(x)$, and hence compute (an under-approximation of) $V_{inner-global}$.
Similarly for the input set underapproximation (Eq.??) computed online, we have $\underline{V}_{k+j|k} = v:   max_{x\in \oa{X}_{k+j|k}} \alpha(x) + (k/IJ)\underline{u} \leq v \leq  min_{x\in \oa{X}_{k+j|k}}\alpha(x) + (k/IJ)\overline{u}$. This set (an under-approximation of it) can also be computed online using interval arithmetic by over-approximating $\oa{x}_{k+j|k}$ by a hyper-rectangle. 

The set of states for the feedback linearized system $Z$ (as computed by ??) is given by:

\begin{equation}
 -\begin{bmatrix} \pi/4  \\ \pi/4  \\ \pi \\ \pi \end{bmatrix} \leq z \leq \begin{bmatrix} \pi/4  \\ \pi/4  \\ \pi \\ \pi \end{bmatrix}
\end{equation}