% run this before the simulink file
v = 5;


% from ros camera_calibration
D =  [-0.33758562758914146, 0.11161239414304096, -0.00021819272592442094, -3.029195446330518e-05];
K =  [430.21554970319971, 0.0, 306.6913434743704, 0.0, 430.53169252696676, 227.22480030078816, 0.0, 0.0, 1.0];
R =  [1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0];
P =  [1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0];

k1 = .00001;%D(1);
k2 = .00023;%D(2);
k3 = .000187;%D(3);

%init conditions
x0 = 0.1;
y0 = 0;
xv0 = 0;
xm0 = 0;
theta0 = 0;

%lin st fb
L1 = -70.1*10^2;
L2 = -100.2*10^2;

%nl st fb
kp = 1.1;

%lin matrices for x,theta
A = [0 v;0 0];
B = [0;1];
C = [0 k1;k2 k3];
D = zeros(2,1);
sys = ss(A,B,C,D);
%LQG
QXU = blkdiag(.01*eye(1),.00001*eye(1),10000000000*eye(1));
QWV = .001*eye(4);
QI = blkdiag(.0001*eye(1),.000001*eye(1));
LQ = lqg(sys,QXU,QWV,QI);