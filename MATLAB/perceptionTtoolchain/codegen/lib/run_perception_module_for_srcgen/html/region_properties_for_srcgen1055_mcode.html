<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="175,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S2T313U3">stats</span> = region_properties_for_srcgen(<span class="var type1" id="S3T27U6">L</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="175,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">% stats: n-by-6, each row contains 'MajorAxisLength', 'MinorAxisLength', 'Eccentricity', 'Solidity', 'Centroid',</span></span></span>
<span class="srcline"><span class="lineno"><a href="175,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">% of the kth component in labeled image L. Centroid is 2D</span></span></span>
<span class="srcline"><span class="lineno"><a href="175,4" id="srcline4"> 4</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="175,5" id="srcline5"> 5</a></span><span class="line"><span class="comment">% By "second moments", the documentation means the second central moment.</span></span></span>
<span class="srcline"><span class="lineno"><a href="175,6" id="srcline6"> 6</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="175,7" id="srcline7"> 7</a></span><span class="line"><span class="comment">% In the case of one-dimensional data, this would be the variance (or square of the standard deviation).</span></span></span>
<span class="srcline"><span class="lineno"><a href="175,8" id="srcline8"> 8</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="175,9" id="srcline9"> 9</a></span><span class="line"><span class="comment">% In your case, where you have two-dimensional data, the second central moment is the covariance matrix.</span></span></span>
<span class="srcline"><span class="lineno"><a href="175,10" id="srcline10">10</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="175,11" id="srcline11">11</a></span><span class="line"><span class="comment">% If X is an n-by-2 matrix of the points in your region, you can compute the covariance matrix Sigma in MATLAB like this (untested):</span></span></span>
<span class="srcline"><span class="lineno"><a href="175,12" id="srcline12">12</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="175,13" id="srcline13">13</a></span><span class="line"><span class="comment">% mu=mean(X,1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="175,14" id="srcline14">14</a></span><span class="line"><span class="comment">% X_minus_mu=X-repmat(mu, size(X,1), 1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="175,15" id="srcline15">15</a></span><span class="line"><span class="comment">% Sigma=(X_minus_mu'*X_minus_mu)/size(X,1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="175,16" id="srcline16">16</a></span><span class="line"><span class="comment">% Now, what does this have to do with ellipses? Well, what you're doing here is, in effect, fitting a multivariate normal distribution to your data. The covariance matrix determines the shape of that distribution, </span></span></span>
<span class="srcline"><span class="lineno"><a href="175,17" id="srcline17">17</a></span><span class="line"><span class="comment">% and the contour lines of a multivariate normal distribution -- wait for it -- are ellipses!</span></span></span>
<span class="srcline"><span class="lineno"><a href="175,18" id="srcline18">18</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="175,19" id="srcline19">19</a></span><span class="line"><span class="comment">% The directions and lengths of the ellipse's axes are given by the eigenvectors and eigenvalues of the covariance matrix:</span></span></span>
<span class="srcline"><span class="lineno"><a href="175,20" id="srcline20">20</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="175,21" id="srcline21">21</a></span><span class="line"><span class="comment">% [V, D]=eig(Sigma);</span></span></span>
<span class="srcline"><span class="lineno"><a href="175,22" id="srcline22">22</a></span><span class="line"><span class="comment">% The columns of V are now the eigenvectors (i.e. the directions of the axes), and values on the diagonal of D are the eigenvalues (i.e. the lengths of the axes). So you already have the 'MajorAxisLength' and 'MinorAxisLength'. </span></span></span>
<span class="srcline"><span class="lineno"><a href="175,23" id="srcline23">23</a></span><span class="line"><span class="comment">% The orientation is probably just the angle between the major axis and the horizontal (hint: use atan2 to compute this from the vector pointing along the major axis). </span></span></span>
<span class="srcline"><span class="lineno"><a href="175,24" id="srcline24">24</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="175,25" id="srcline25">25</a></span><span class="line"><span class="comment">%Finally, the eccentricity is</span></span></span>
<span class="srcline"><span class="lineno"><a href="175,26" id="srcline26">26</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="175,27" id="srcline27">27</a></span><span class="line"><span class="comment">% sqrt(1-(b/a)^2)</span></span></span>
<span class="srcline"><span class="lineno"><a href="175,28" id="srcline28">28</a></span><span class="line"><span class="comment">% where a is the length of the major axis and b is the length of the minor axis.</span></span></span>
<span class="srcline"><span class="lineno"><a href="175,29" id="srcline29">29</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="175,30" id="srcline30">30</a></span><span class="line"><span class="mxinfo " id="T2:U3"><span class="var type1" id="S4T2U9">nbregions</span> = <span class="mxinfo " id="T2:U5">max(<span class="mxinfo " id="T304:U6">max(<span class="var type1" id="S3T27U14">L</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="175,31" id="srcline31">31</a></span><span class="line"><span class="mxinfo " id="T313:U8"><span class="var type1" id="S2T313U17">stats</span> = <span class="mxinfo " id="T313:U10">complex(<span class="mxinfo " id="T317:U11">zeros(<span class="var type1" id="S4T2U22">nbregions</span>,<span class="mxinfo " id="T2:U13">6</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="175,32" id="srcline32">32</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S8T2U26">n</span>=<span class="mxinfo " id="T2:U15">1</span>:<span class="var type1" id="S4T2U29">nbregions</span></span></span>
<span class="srcline"><span class="lineno"><a href="175,33" id="srcline33">33</a></span><span class="line">    <span class="mxinfo " id="T325:U17"><span class="var type1" id="S9T325U32">ff</span> = <span class="mxinfo " id="T325:U19">find(<span class="mxinfo " id="T29:U20"><span class="var type1" id="S3T27U36">L</span>==<span class="var type1" id="S8T2U37">n</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="175,34" id="srcline34">34</a></span><span class="line">    [<span class="mxinfo " id="T325:U23"><span class="var type1" id="S11T325U41">I</span></span>,<span class="mxinfo " id="T325:U25"><span class="var type1" id="S12T325U42">J</span></span>] = ind2sub(size(<span class="var type1" id="S3T27U47">L</span>),<span class="var type1" id="S9T325U48">ff</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="175,35" id="srcline35">35</a></span><span class="line">    <span class="mxinfo " id="T327:U29"><span class="var type1" id="S15T327U51">X</span> = <span class="mxinfo " id="T327:U31">[<span class="var type1" id="S11T325U54">I</span>,<span class="var type1" id="S12T325U55">J</span>]</span></span>;    </span></span>
<span class="srcline"><span class="lineno"><a href="175,36" id="srcline36">36</a></span><span class="line">    <span class="mxinfo " id="T41:U34"><span class="var type1" id="S16T41U58">mu</span> = <span class="mxinfo " id="T41:U36">mean(<span class="var type1" id="S15T327U61">X</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="175,37" id="srcline37">37</a></span><span class="line">    <span class="mxinfo " id="T327:U38"><span class="var type1" id="S18T327U65">X_minus_mu</span> = <span class="mxinfo " id="T327:U40"><span class="var type1" id="S15T327U67">X</span> - <span class="mxinfo " id="T327:U42">repmat(<span class="var type1" id="S16T41U70">mu</span>, <span class="mxinfo " id="T2:U44">size(<span class="var type1" id="S15T327U73">X</span>,1)</span>, 1)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="175,38" id="srcline38">38</a></span><span class="line">    <span class="mxinfo " id="T308:U46"><span class="var type1" id="S20T308U78">Sigma</span>=<span class="mxinfo " id="T308:U48">(<span class="mxinfo " id="T308:U49"><span class="mxinfo " id="T331:U50"><span class="var type1" id="S18T327U83">X_minus_mu</span>'</span>*<span class="var type1" id="S18T327U84">X_minus_mu</span></span>)/<span class="mxinfo " id="T2:U53">size(<span class="var type1" id="S15T327U87">X</span>,1)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="175,39" id="srcline39">39</a></span><span class="line">    <span class="mxinfo " id="T312:U55"><span class="var type1" id="S21T312U91">D</span> = <span class="mxinfo " id="T312:U57">eig(<span class="var type1" id="S20T308U94">Sigma</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="175,40" id="srcline40">40</a></span><span class="line">    <span class="mxinfo " id="T309:U59"><span class="var type1" id="S23T309U97">MajorAxisLength</span> = <span class="mxinfo " id="T309:U61">max(<span class="var type1" id="S21T312U100">D</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="175,41" id="srcline41">41</a></span><span class="line">    <span class="mxinfo " id="T309:U63"><span class="var type1" id="S24T309U103">MinorAxisLength</span> = <span class="mxinfo " id="T309:U65">min(<span class="var type1" id="S21T312U106">D</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="175,42" id="srcline42">42</a></span><span class="line">    <span class="mxinfo " id="T102:U67"><span class="extrinsicFcn" id="F1144N3:B109">assert</span>(<span class="mxinfo " id="T4:U68"><span class="var type1" id="S23T309U111">MajorAxisLength</span> &gt; <span class="mxinfo " id="T2:U70">0</span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="175,43" id="srcline43">43</a></span><span class="line">    <span class="mxinfo " id="T102:U71"><span class="extrinsicFcn" id="F1145N3:B115">assert</span>(<span class="mxinfo " id="T4:U72"><span class="var type1" id="S24T309U117">MinorAxisLength</span> &gt;= <span class="mxinfo " id="T2:U74">0</span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="175,44" id="srcline44">44</a></span><span class="line">    <span class="mxinfo " id="T309:U75"><span class="var type1" id="S27T309U121">Eccentricity</span> = <span class="mxinfo " id="T309:U77">sqrt(<span class="mxinfo " id="T309:U78"><span class="mxinfo " id="T2:U79">1</span>-<span class="mxinfo " id="T309:U80">(<span class="mxinfo " id="T309:U81"><span class="var type1" id="S24T309U129">MinorAxisLength</span>/<span class="var type1" id="S23T309U130">MajorAxisLength</span></span>)^2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="175,45" id="srcline45">45</a></span><span class="line">    <span class="mxinfo " id="T2:U84"><span class="var type1" id="S29T2U134">Area</span> = <span class="mxinfo " id="T2:U86">length(<span class="var type1" id="S9T325U137">ff</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="175,46" id="srcline46">46</a></span><span class="line">    <span class="mxinfo " id="T41:U88"><span class="var type1" id="S31T41U140">Centroid</span> = <span class="mxinfo " id="T41:U90"><span class="mxinfo " id="T41:U91">sum(<span class="var type1" id="S15T327U144">X</span>)</span>./<span class="var type1" id="S29T2U145">Area</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="175,47" id="srcline47">47</a></span><span class="line">    <span class="mxinfo " id="T309:U94"><span class="mxinfo " id="T309:U95"><span class="var type1" id="S2T313U149">stats</span>(<span class="var type1" id="S8T2U150">n</span>,<span class="mxinfo " id="T2:U98">1</span>)</span> = <span class="var type1" id="S23T309U152">MajorAxisLength</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="175,48" id="srcline48">48</a></span><span class="line">    <span class="mxinfo " id="T309:U100"><span class="mxinfo " id="T309:U101"><span class="var type1" id="S2T313U156">stats</span>(<span class="var type1" id="S8T2U157">n</span>,<span class="mxinfo " id="T2:U104">2</span>)</span> = <span class="var type1" id="S24T309U159">MinorAxisLength</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="175,49" id="srcline49">49</a></span><span class="line">    <span class="mxinfo " id="T309:U106"><span class="mxinfo " id="T309:U107"><span class="var type1" id="S2T313U163">stats</span>(<span class="var type1" id="S8T2U164">n</span>,<span class="mxinfo " id="T2:U110">3</span>)</span> = <span class="var type1" id="S27T309U166">Eccentricity</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="175,50" id="srcline50">50</a></span><span class="line">    <span class="mxinfo " id="T309:U112"><span class="mxinfo " id="T309:U113"><span class="var type1" id="S2T313U170">stats</span>(<span class="var type1" id="S8T2U171">n</span>,<span class="mxinfo " id="T2:U116">4</span>)</span> = <span class="mxinfo " id="T2:U117">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="175,51" id="srcline51">51</a></span><span class="line">    <span class="mxinfo " id="T400:U118"><span class="mxinfo " id="T400:U119"><span class="var type1" id="S2T313U177">stats</span>(<span class="var type1" id="S8T2U178">n</span>,<span class="mxinfo " id="T41:U122"><span class="mxinfo " id="T2:U123">5</span>:<span class="mxinfo " id="T2:U124">6</span></span>)</span> = <span class="var type1" id="S31T41U182">Centroid</span></span>;    </span></span>
<span class="srcline"><span class="lineno"><a href="175,52" id="srcline52">52</a></span><span class="line"><span class="keyword"><span class="keyword">end</span></span></span></span>
</pre>
