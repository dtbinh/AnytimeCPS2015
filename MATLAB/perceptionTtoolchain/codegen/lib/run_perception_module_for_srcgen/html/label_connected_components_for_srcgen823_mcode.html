<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="146,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S2T27U3">L</span> = label_connected_components_for_srcgen(<span class="var type1" id="S3T29U6">BW</span>, <span class="mxinfo " id="T2:U3"><span class="var type2" id="S4T2V1U7">n</span></span>, <span class="var type1" id="S5T2U8">minimumSize</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="146,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">% n = 4 or 8</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">% BW = black and white image</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,4" id="srcline4"> 4</a></span><span class="line"><span class="comment">% minimumSize: ignore all components of less than a minimumSize pixels</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,5" id="srcline5"> 5</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="146,6" id="srcline6"> 6</a></span><span class="line"><span class="mxinfo " id="T27:U6"><span class="var type1" id="S2T27U11">L</span> = <span class="mxinfo " id="T27:U8">zeros(size(<span class="var type1" id="S3T29U16">BW</span>))</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,7" id="srcline7"> 7</a></span><span class="line"><span class="mxinfo " id="T297:U10"><span class="message warning" id="M3F823C"><span class="var type1" id="S8T297U19">q</span> = []</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,8" id="srcline8"> 8</a></span><span class="line"><span class="mxinfo " id="T2:U12"><span class="var type1" id="S9T2U24">curlabel</span> = <span class="mxinfo " id="T2:U14">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,9" id="srcline9"> 9</a></span><span class="line"><span class="mxinfo " id="T41:U15"><span class="var type1" id="S10T41U28">a</span> = <span class="mxinfo " id="T41:U17">size(<span class="var type1" id="S3T29U31">BW</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,10" id="srcline10">10</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S11T2U34">i</span>=<span class="mxinfo " id="T2:U20">1</span>:<span class="var type1" id="S10T41U38">a</span>(1)</span></span>
<span class="srcline"><span class="lineno"><a href="146,11" id="srcline11">11</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S12T2U42">j</span>=<span class="mxinfo " id="T2:U23">1</span>:<span class="var type1" id="S10T41U46">a</span>(2)</span></span>
<span class="srcline"><span class="lineno"><a href="146,12" id="srcline12">12</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo " id="T4:U25"><span class="mxinfo " id="T4:U26"><span class="var type1" id="S3T29U53">BW</span>(<span class="var type1" id="S11T2U54">i</span>,<span class="var type1" id="S12T2U55">j</span>)</span>==<span class="mxinfo " id="T2:U30">1</span></span> &amp;&amp; <span class="mxinfo " id="T4:U31">~<span class="mxinfo " id="T2:U32"><span class="var type1" id="S2T27U59">L</span>(<span class="var type1" id="S11T2U60">i</span>,<span class="var type1" id="S12T2U61">j</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="146,13" id="srcline13">13</a></span><span class="line">            <span class="mxinfo " id="T2:U36"><span class="mxinfo " id="T2:U37"><span class="var type1" id="S2T27U65">L</span>(<span class="var type1" id="S11T2U66">i</span>,<span class="var type1" id="S12T2U67">j</span>)</span>=<span class="var type1" id="S9T2U68">curlabel</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,14" id="srcline14">14</a></span><span class="line">            <span class="mxinfo " id="T297:U42"><span class="var type1" id="S8T297U71">q</span> = <span class="mxinfo " id="T297:U44">[<span class="var type1" id="S8T297U74">q</span>; <span class="mxinfo " id="T41:U46"><span class="var type1" id="S11T2U76">i</span>,<span class="var type1" id="S12T2U77">j</span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,15" id="srcline15">15</a></span><span class="line">            <span class="comment">% pop</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,16" id="srcline16">16</a></span><span class="line">            <span class="keyword">while</span> <span class="mxinfo " id="T4:U49">~<span class="mxinfo " id="T4:U50">isempty(<span class="var type1" id="S8T297U82">q</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="146,17" id="srcline17">17</a></span><span class="line">                <span class="mxinfo " id="T41:U52"><span class="var type1" id="S14T41U85">p</span> = <span class="mxinfo " id="T41:U54"><span class="var type1" id="S8T297U87">q</span>(<span class="mxinfo " id="T2:U56">1</span>,:)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,18" id="srcline18">18</a></span><span class="line">                <span class="mxinfo " id="T297:U57"><span class="var type1" id="S8T297U92">q</span> = <span class="mxinfo " id="T297:U59"><span class="var type1" id="S8T297U94">q</span>(<span class="mxinfo " id="T4:U61"><span class="mxinfo " id="T2:U62">2</span>:<span class="mxinfo " id="T2:U63">end</span></span>,:)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,19" id="srcline19">19</a></span><span class="line">                <span class="comment">% get neighbors</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,20" id="srcline20">20</a></span><span class="line">                <span class="mxinfo " id="T326:U64"><span class="var type1" id="S16T326U102">nhbrs</span> = <span class="mxinfo " id="T326:U66"><span class="fcn" id="F819N6:B104">get_neighbours</span>(<span class="mxinfo " id="T2:U67"><span class="var type1" id="S4T2U105">n</span></span>,<span class="mxinfo " id="T2:U69"><span class="var type1" id="S14T41U107">p</span>(<span class="mxinfo " id="T2:U71">1</span>)</span>,<span class="mxinfo " id="T2:U72"><span class="var type1" id="S14T41U110">p</span>(<span class="mxinfo " id="T2:U74">2</span>)</span>,<span class="mxinfo " id="T2:U75"><span class="var type1" id="S10T41U113">a</span>(1)</span>,<span class="mxinfo " id="T2:U77"><span class="var type1" id="S10T41U116">a</span>(2)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,21" id="srcline21">21</a></span><span class="line">                <span class="keyword">for</span> <span class="var type1" id="S18T2U120">k</span>=<span class="mxinfo " id="T2:U80">1</span>:<span class="mxinfo " id="T2:U81">size(<span class="var type1" id="S16T326U125">nhbrs</span>,1)</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,22" id="srcline22">22</a></span><span class="line">                    <span class="keyword">if</span> <span class="mxinfo " id="T4:U83"><span class="mxinfo " id="T4:U84"><span class="var type1" id="S3T29U132">BW</span>(<span class="mxinfo " id="T2:U86"><span class="var type1" id="S16T326U134">nhbrs</span>(<span class="var type1" id="S18T2U135">k</span>,<span class="mxinfo " id="T2:U89">1</span>)</span>,<span class="mxinfo " id="T2:U90"><span class="var type1" id="S16T326U138">nhbrs</span>(<span class="var type1" id="S18T2U139">k</span>,<span class="mxinfo " id="T2:U93">2</span>)</span>)</span>==<span class="mxinfo " id="T2:U94">1</span></span> &amp;&amp; <span class="mxinfo " id="T4:U95">~<span class="mxinfo " id="T2:U96"><span class="var type1" id="S2T27U144">L</span>(<span class="mxinfo " id="T2:U98"><span class="var type1" id="S16T326U146">nhbrs</span>(<span class="var type1" id="S18T2U147">k</span>,<span class="mxinfo " id="T2:U101">1</span>)</span>,<span class="mxinfo " id="T2:U102"><span class="var type1" id="S16T326U150">nhbrs</span>(<span class="var type1" id="S18T2U151">k</span>,<span class="mxinfo " id="T2:U105">2</span>)</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="146,23" id="srcline23">23</a></span><span class="line">                        <span class="mxinfo " id="T2:U106"><span class="mxinfo " id="T2:U107"><span class="var type1" id="S2T27U156">L</span>(<span class="mxinfo " id="T2:U109"><span class="var type1" id="S16T326U158">nhbrs</span>(<span class="var type1" id="S18T2U159">k</span>,<span class="mxinfo " id="T2:U112">1</span>)</span>, <span class="mxinfo " id="T2:U113"><span class="var type1" id="S16T326U162">nhbrs</span>(<span class="var type1" id="S18T2U163">k</span>,<span class="mxinfo " id="T2:U116">2</span>)</span>)</span>=<span class="var type1" id="S9T2U165">curlabel</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,24" id="srcline24">24</a></span><span class="line">                        <span class="mxinfo " id="T297:U118"><span class="var type1" id="S8T297U168">q</span> = <span class="mxinfo " id="T297:U120">[<span class="var type1" id="S8T297U171">q</span>;<span class="mxinfo " id="T41:U122"><span class="var type1" id="S16T326U174">nhbrs</span>(<span class="var type1" id="S18T2U175">k</span>,:)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,25" id="srcline25">25</a></span><span class="line">                    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,26" id="srcline26">26</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,27" id="srcline27">27</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,28" id="srcline28">28</a></span><span class="line">            <span class="mxinfo " id="T325:U125"><span class="var type1" id="S19T325U179">ff</span> = <span class="mxinfo " id="T325:U127">find(<span class="mxinfo " id="T29:U128"><span class="var type1" id="S2T27U183">L</span>==<span class="var type1" id="S9T2U184">curlabel</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,29" id="srcline29">29</a></span><span class="line">            <span class="mxinfo " id="T2:U131"><span class="var type1" id="S21T2U187">nbPix</span> = <span class="mxinfo " id="T2:U133">length(<span class="var type1" id="S19T325U190">ff</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,30" id="srcline30">30</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo " id="T4:U135"><span class="var type1" id="S21T2U194">nbPix</span> &lt;= <span class="mxinfo " id="T2:U137"><span class="var type1" id="S5T2U195">minimumSize</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="146,31" id="srcline31">31</a></span><span class="line">                <span class="mxinfo " id="T325:U139"><span class="mxinfo " id="T325:U140"><span class="var type1" id="S2T27U199">L</span>(<span class="var type1" id="S19T325U200">ff</span>)</span>=<span class="mxinfo " id="T2:U143">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,32" id="srcline32">32</a></span><span class="line">            <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,33" id="srcline33">33</a></span><span class="line">                <span class="mxinfo " id="T2:U144"><span class="var type1" id="S9T2U205">curlabel</span> = <span class="mxinfo " id="T2:U146"><span class="var type1" id="S9T2U207">curlabel</span>+<span class="mxinfo " id="T2:U148">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,34" id="srcline34">34</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,35" id="srcline35">35</a></span><span class="line">        <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,36" id="srcline36">36</a></span><span class="line">            <span class="comment">% do nothing</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,37" id="srcline37">37</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,38" id="srcline38">38</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,39" id="srcline39">39</a></span><span class="line"><span class="keyword"><span class="keyword">end</span></span></span></span>
</pre>
