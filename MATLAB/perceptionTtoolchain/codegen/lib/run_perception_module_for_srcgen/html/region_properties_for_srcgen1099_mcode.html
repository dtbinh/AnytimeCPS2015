<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="181,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S2T314U3">stats</span> = region_properties_for_srcgen(<span class="var type1" id="S3T27U6">L</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="181,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">% stats: n-by-6, each row contains 'MajorAxisLength', 'MinorAxisLength', 'Eccentricity', 'Solidity', 'Centroid',</span></span></span>
<span class="srcline"><span class="lineno"><a href="181,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">% of the kth component in labeled image L. Centroid is 2D</span></span></span>
<span class="srcline"><span class="lineno"><a href="181,4" id="srcline4"> 4</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="181,5" id="srcline5"> 5</a></span><span class="line"><span class="comment">% By "second moments", the documentation means the second central moment.</span></span></span>
<span class="srcline"><span class="lineno"><a href="181,6" id="srcline6"> 6</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="181,7" id="srcline7"> 7</a></span><span class="line"><span class="comment">% In the case of one-dimensional data, this would be the variance (or square of the standard deviation).</span></span></span>
<span class="srcline"><span class="lineno"><a href="181,8" id="srcline8"> 8</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="181,9" id="srcline9"> 9</a></span><span class="line"><span class="comment">% In your case, where you have two-dimensional data, the second central moment is the covariance matrix.</span></span></span>
<span class="srcline"><span class="lineno"><a href="181,10" id="srcline10">10</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="181,11" id="srcline11">11</a></span><span class="line"><span class="comment">% If X is an n-by-2 matrix of the points in your region, you can compute the covariance matrix Sigma in MATLAB like this (untested):</span></span></span>
<span class="srcline"><span class="lineno"><a href="181,12" id="srcline12">12</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="181,13" id="srcline13">13</a></span><span class="line"><span class="comment">% mu=mean(X,1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="181,14" id="srcline14">14</a></span><span class="line"><span class="comment">% X_minus_mu=X-repmat(mu, size(X,1), 1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="181,15" id="srcline15">15</a></span><span class="line"><span class="comment">% Sigma=(X_minus_mu'*X_minus_mu)/size(X,1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="181,16" id="srcline16">16</a></span><span class="line"><span class="comment">% Now, what does this have to do with ellipses? Well, what you're doing here is, in effect, fitting a multivariate normal distribution to your data. The covariance matrix determines the shape of that distribution, </span></span></span>
<span class="srcline"><span class="lineno"><a href="181,17" id="srcline17">17</a></span><span class="line"><span class="comment">% and the contour lines of a multivariate normal distribution -- wait for it -- are ellipses!</span></span></span>
<span class="srcline"><span class="lineno"><a href="181,18" id="srcline18">18</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="181,19" id="srcline19">19</a></span><span class="line"><span class="comment">% The directions and lengths of the ellipse's axes are given by the eigenvectors and eigenvalues of the covariance matrix:</span></span></span>
<span class="srcline"><span class="lineno"><a href="181,20" id="srcline20">20</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="181,21" id="srcline21">21</a></span><span class="line"><span class="comment">% [V, D]=eig(Sigma);</span></span></span>
<span class="srcline"><span class="lineno"><a href="181,22" id="srcline22">22</a></span><span class="line"><span class="comment">% The columns of V are now the eigenvectors (i.e. the directions of the axes), and values on the diagonal of D are the eigenvalues (i.e. the lengths of the axes). So you already have the 'MajorAxisLength' and 'MinorAxisLength'. </span></span></span>
<span class="srcline"><span class="lineno"><a href="181,23" id="srcline23">23</a></span><span class="line"><span class="comment">% The orientation is probably just the angle between the major axis and the horizontal (hint: use atan2 to compute this from the vector pointing along the major axis). </span></span></span>
<span class="srcline"><span class="lineno"><a href="181,24" id="srcline24">24</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="181,25" id="srcline25">25</a></span><span class="line"><span class="comment">%Finally, the eccentricity is</span></span></span>
<span class="srcline"><span class="lineno"><a href="181,26" id="srcline26">26</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="181,27" id="srcline27">27</a></span><span class="line"><span class="comment">% sqrt(1-(b/a)^2)</span></span></span>
<span class="srcline"><span class="lineno"><a href="181,28" id="srcline28">28</a></span><span class="line"><span class="comment">% where a is the length of the major axis and b is the length of the minor axis.</span></span></span>
<span class="srcline"><span class="lineno"><a href="181,29" id="srcline29">29</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="181,30" id="srcline30">30</a></span><span class="line"><span class="mxinfo " id="T2:U3"><span class="var type1" id="S4T2U9">nbregions</span> = <span class="mxinfo " id="T2:U5">max(<span class="mxinfo " id="T304:U6">max(<span class="var type1" id="S3T27U14">L</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="181,31" id="srcline31">31</a></span><span class="line"><span class="mxinfo " id="T314:U8"><span class="var type1" id="S2T314U17">stats</span> = <span class="mxinfo " id="T314:U10">complex(<span class="mxinfo " id="T318:U11">zeros(<span class="var type1" id="S4T2U22">nbregions</span>,<span class="mxinfo " id="T2:U13">6</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="181,32" id="srcline32">32</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S8T2U26">n</span>=<span class="mxinfo " id="T2:U15">1</span>:<span class="var type1" id="S4T2U29">nbregions</span></span></span>
<span class="srcline"><span class="lineno"><a href="181,33" id="srcline33">33</a></span><span class="line">    <span class="mxinfo " id="T326:U17"><span class="var type1" id="S9T326U32">ff</span> = <span class="mxinfo " id="T326:U19">find(<span class="mxinfo " id="T29:U20"><span class="var type1" id="S3T27U36">L</span>==<span class="var type1" id="S8T2U37">n</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="181,34" id="srcline34">34</a></span><span class="line">    [<span class="mxinfo " id="T326:U23"><span class="var type1" id="S11T326U41">I</span></span>,<span class="mxinfo " id="T326:U25"><span class="var type1" id="S12T326U42">J</span></span>] = ind2sub(size(<span class="var type1" id="S3T27U47">L</span>),<span class="var type1" id="S9T326U48">ff</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="181,35" id="srcline35">35</a></span><span class="line">    <span class="mxinfo " id="T328:U29"><span class="var type1" id="S15T328U51">X</span> = <span class="mxinfo " id="T328:U31">[<span class="var type1" id="S11T326U54">I</span>,<span class="var type1" id="S12T326U55">J</span>]</span></span>;    </span></span>
<span class="srcline"><span class="lineno"><a href="181,36" id="srcline36">36</a></span><span class="line">    <span class="mxinfo " id="T41:U34"><span class="var type1" id="S16T41U58">mu</span> = <span class="mxinfo " id="T41:U36">mean(<span class="var type1" id="S15T328U61">X</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="181,37" id="srcline37">37</a></span><span class="line">    <span class="mxinfo " id="T328:U38"><span class="var type1" id="S18T328U65">X_minus_mu</span> = <span class="mxinfo " id="T328:U40"><span class="var type1" id="S15T328U67">X</span> - <span class="mxinfo " id="T328:U42">repmat(<span class="var type1" id="S16T41U70">mu</span>, <span class="mxinfo " id="T2:U44">size(<span class="var type1" id="S15T328U73">X</span>,1)</span>, 1)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="181,38" id="srcline38">38</a></span><span class="line">    <span class="mxinfo " id="T308:U46"><span class="var type1" id="S20T308U78">Sigma</span>=<span class="mxinfo " id="T308:U48">(<span class="mxinfo " id="T308:U49"><span class="mxinfo " id="T332:U50"><span class="var type1" id="S18T328U83">X_minus_mu</span>'</span>*<span class="var type1" id="S18T328U84">X_minus_mu</span></span>)/<span class="mxinfo " id="T2:U53">size(<span class="var type1" id="S15T328U87">X</span>,1)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="181,39" id="srcline39">39</a></span><span class="line">    <span class="mxinfo " id="T312:U55"><span class="var type1" id="S21T312U91">D</span> = <span class="mxinfo " id="T312:U57">eig(<span class="var type1" id="S20T308U94">Sigma</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="181,40" id="srcline40">40</a></span><span class="line">    <span class="mxinfo " id="T309:U59"><span class="var type1" id="S23T309U97">MajorAxisLength</span> = <span class="mxinfo " id="T309:U61">max(<span class="var type1" id="S21T312U100">D</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="181,41" id="srcline41">41</a></span><span class="line">    <span class="mxinfo " id="T309:U63"><span class="var type1" id="S24T309U103">MinorAxisLength</span> = <span class="mxinfo " id="T309:U65">min(<span class="var type1" id="S21T312U106">D</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="181,42" id="srcline42">42</a></span><span class="line">    <span class="mxinfo " id="T102:U67"><span class="extrinsicFcn" id="F1187N3:B109">assert</span>(<span class="mxinfo " id="T4:U68"><span class="var type1" id="S23T309U111">MajorAxisLength</span> &gt; <span class="mxinfo " id="T2:U70">0</span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="181,43" id="srcline43">43</a></span><span class="line">    <span class="mxinfo " id="T102:U71"><span class="extrinsicFcn" id="F1188N3:B115">assert</span>(<span class="mxinfo " id="T4:U72"><span class="var type1" id="S24T309U117">MinorAxisLength</span> &gt;= <span class="mxinfo " id="T2:U74">0</span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="181,44" id="srcline44">44</a></span><span class="line">    <span class="mxinfo " id="T309:U75"><span class="var type1" id="S27T309U121">Eccentricity</span> = <span class="mxinfo " id="T309:U77">sqrt(<span class="mxinfo " id="T309:U78"><span class="mxinfo " id="T2:U79">1</span>-<span class="mxinfo " id="T309:U80">(<span class="mxinfo " id="T309:U81"><span class="var type1" id="S24T309U129">MinorAxisLength</span>/<span class="var type1" id="S23T309U130">MajorAxisLength</span></span>)^2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="181,45" id="srcline45">45</a></span><span class="line">    <span class="mxinfo " id="T2:U84"><span class="var type1" id="S29T2U134">Area</span> = <span class="mxinfo " id="T2:U86">length(<span class="var type1" id="S9T326U137">ff</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="181,46" id="srcline46">46</a></span><span class="line">    <span class="mxinfo " id="T41:U88"><span class="var type1" id="S31T41U140">Centroid</span> = <span class="mxinfo " id="T41:U90"><span class="mxinfo " id="T41:U91">sum(<span class="var type1" id="S15T328U144">X</span>)</span>./<span class="var type1" id="S29T2U145">Area</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="181,47" id="srcline47">47</a></span><span class="line">    [<span class="mxinfo " id="T328:U94"><span class="var type1" id="S33T328U149">convex_hull</span></span>, <span class="mxinfo " id="T2:U96"><span class="var type1" id="S34T2U150">charea</span></span>] = <span class="fcn" id="F1098N7:B152">graham_scan</span>(<span class="var type1" id="S15T328U153">X</span>,size(<span class="var type1" id="S3T27U156">L</span>,1),size(<span class="var type1" id="S3T27U160">L</span>,2));</span></span>
<span class="srcline"><span class="lineno"><a href="181,48" id="srcline48">48</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="181,49" id="srcline49">49</a></span><span class="line">    <span class="mxinfo " id="T309:U101"><span class="mxinfo " id="T309:U102"><span class="var type1" id="S2T314U165">stats</span>(<span class="var type1" id="S8T2U166">n</span>,<span class="mxinfo " id="T2:U105">1</span>)</span> = <span class="var type1" id="S23T309U168">MajorAxisLength</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="181,50" id="srcline50">50</a></span><span class="line">    <span class="mxinfo " id="T309:U107"><span class="mxinfo " id="T309:U108"><span class="var type1" id="S2T314U172">stats</span>(<span class="var type1" id="S8T2U173">n</span>,<span class="mxinfo " id="T2:U111">2</span>)</span> = <span class="var type1" id="S24T309U175">MinorAxisLength</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="181,51" id="srcline51">51</a></span><span class="line">    <span class="mxinfo " id="T309:U113"><span class="mxinfo " id="T309:U114"><span class="var type1" id="S2T314U179">stats</span>(<span class="var type1" id="S8T2U180">n</span>,<span class="mxinfo " id="T2:U117">3</span>)</span> = <span class="var type1" id="S27T309U182">Eccentricity</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="181,52" id="srcline52">52</a></span><span class="line">    <span class="mxinfo " id="T309:U119"><span class="mxinfo " id="T309:U120"><span class="var type1" id="S2T314U186">stats</span>(<span class="var type1" id="S8T2U187">n</span>,<span class="mxinfo " id="T2:U123">4</span>)</span> = <span class="mxinfo " id="T2:U124"><span class="var type1" id="S29T2U190">Area</span>/<span class="var type1" id="S34T2U191">charea</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="181,53" id="srcline53">53</a></span><span class="line">    <span class="mxinfo " id="T408:U127"><span class="mxinfo " id="T408:U128"><span class="var type1" id="S2T314U195">stats</span>(<span class="var type1" id="S8T2U196">n</span>,<span class="mxinfo " id="T41:U131"><span class="mxinfo " id="T2:U132">5</span>:<span class="mxinfo " id="T2:U133">6</span></span>)</span> = <span class="var type1" id="S31T41U200">Centroid</span></span>;    </span></span>
<span class="srcline"><span class="lineno"><a href="181,54" id="srcline54">54</a></span><span class="line"><span class="keyword"><span class="keyword">end</span></span></span></span>
</pre>
